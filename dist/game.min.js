/*! bungee-owl 2013-08-27 */
function gameInit(){init_keys();var a=new createjs.Bitmap(assets.image.background["green-bg"]);for(setObjectProps(a,{scale:1,scaleX:.5,scaleY:.5}),bitmaps.bg=a,stage.addChild(a),i=0;5>i;i++){var b=new createjs.Bitmap(assets.image.background.gravel50x50);setObjectProps(b,{scale:1}),b.setTransform(50*i,0),bitmaps["gravel"+i]=b,stage.addChild(b)}var c=new createjs.SpriteSheet({images:[assets.sprite.people.turtle,assets.image.people.turtle_stand],frames:{width:50,height:75,regX:25,regY:75},animations:{run:[0,3,"run",assets.config.gameplay.fps/15],stand:[4,4,"stand",assets.config.gameplay.fps/15]}});createjs.SpriteSheetUtils.addFlippedFrames(c,!0,!1,!1);var d=new createjs.BitmapAnimation(c);d.gotoAndPlay("stand"),setObjectProps(d,{scale:1,speedX:.3,speedY:.2,padX:25,padY:75,x:25,y:canvas.height}),d.rescale=function(a){scaleObjectProps(a,this,["scaleX","scaleY","x","y","padX","padY","speedX","speedY"])},animations.turtleAnimation=d,stage.addChild(d),createjs.Ticker.addEventListener("tick",turtle),createjs.Ticker.useRAF=!0,createjs.Ticker.setFPS(assets.config.gameplay.fps)}function rescale(a){$.each([animations,bitmaps],function(){$.each(this,function(){var b=a/this.scale;this.scale=a,"function"==typeof this.rescale?this.rescale(b):scaleObjectProps(b,this,["scaleX","scaleY","x","y"])})})}function turtle(a){var b=animations.turtleAnimation;keys.right^keys.left&&(keys.right?("run"!==b.currentAnimation&&b.gotoAndPlay("run"),b.x<canvas.width-b.padX&&(b.x+=b.speedX*a.delta)):keys.left&&("run_h"!==b.currentAnimation&&b.gotoAndPlay("run_h"),b.x>b.padX&&(b.x-=b.speedX*a.delta))),keys.up^keys.down&&(keys.up?b.y>b.padY&&(b.y-=b.speedY*a.delta):keys.down&&b.y<canvas.height&&(b.y+=b.speedY*a.delta)),keys.up||keys.down||keys.left||keys.right||("run"===b.currentAnimation?b.gotoAndPlay("stand"):"run_h"===b.currentAnimation&&b.gotoAndPlay("stand_h")),stage.update()}function init_keys(){function a(a){return assets.config.controls[a]||null}$(window).keydown(function(b){var c=a(b.which);null!==c&&(b.preventDefault(),keys[c]=!0)}),$(window).keyup(function(b){var c=a(b.which);null!==c&&(b.preventDefault(),delete keys[c])})}function init(){canvas=document.getElementById("gameCanvas"),stage=new createjs.Stage(canvas);var a={barx:50,bary:100,barw:400,barh:15,padx:10,pady:5,colour:"white",progress:5},b=new createjs.Text("Loading...","20px Arial",a.colour);b.setTransform(a.barx,a.bary-a.barh-4*a.pady),progressbar=new createjs.Shape,progressbar.graphics.f(a.colour).rect(a.barx,a.bary,a.progress,a.barh);var c=new createjs.Shape;c.graphics.s(a.colour).rect(a.barx-a.padx,a.bary-a.pady,a.barw+2*a.padx,a.barh+2*a.pady).es(),stage.addChild(progressbar),stage.addChild(b),stage.addChild(c),stage.update(),$.getJSON("cfg/preload_manifest.json",function(b){var c=new createjs.LoadQueue;c.addEventListener("complete",preloadComplete),c.addEventListener("fileload",function(b){var c=b.item.id.split("."),d=c.pop(),e=assets;c.forEach(function(a){"undefined"!=typeof e[a]?e=e[a]:(e[a]={},e=e[a])}),e[d]=b.result,progressbar.graphics.clear(),progressbar.graphics.f(a.colour).rect(a.barx,a.bary,a.progress+=a.progressInterval,a.barh),stage.update()}),c.loadManifest(b),a.progressInterval=parseInt((a.barw-5)*(1/b.length),10)})}function preloadComplete(){console.log("Assets Loaded."),console.log(assets),stage.removeAllChildren(),gameInit()}var animations={},bitmaps={},InputHandler={walkUp:function(){},walkDown:function(){},walkLeft:function(){},walkRight:function(){}};scaleObjectProps=function(a,b,c){$.each(c,function(){b[this]*=a})},setObjectProps=function(a,b){$.each(b,function(b,c){a[b]=c})};var keys={},stage,canvas,assets={};